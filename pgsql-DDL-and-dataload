1.
=========
insert into cases select * from public.cases;


2.
=========
SELECT id, name, opinion
FROM cases
WHERE opinion ILIKE '%Water leaking into the apartment from the floor above%';

3.
=========
ALTER TABLE cases ADD COLUMN IF NOT EXISTS opinions_vector vector(1536);

4.
=========
UPDATE cases
SET opinions_vector = azure_openai.create_embeddings(
    'text-embedding-3-small',
    name || LEFT(opinion, 8000),
    max_attempts => 5,
    retry_delay_ms => 500
)::vector
WHERE opinions_vector IS NULL;

5.
=========
CREATE EXTENSION IF NOT EXISTS pg_diskann;
CREATE INDEX IF NOT EXISTS cases_cosine_diskann ON cases USING diskann(opinions_vector vector_cosine_ops);

6.
=========
SELECT opinions_vector FROM cases LIMIT 1;

7.
=========
SELECT id, name
FROM cases
ORDER BY opinions_vector <=> azure_openai.create_embeddings(
    'text-embedding-3-small',
    'Water leaking into the apartment from the floor above.'
)::vector
LIMIT 10;

8.
=========
SELECT id, opinion
FROM cases
ORDER BY opinions_vector <=> azure_openai.create_embeddings(
    'text-embedding-3-small',
    'Water leaking into the apartment from the floor above.'
)::vector
LIMIT 1;

REF : 
=========
https://github.com/jjfrost/pg-af-agents-lab/tree/main



